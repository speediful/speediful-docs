"use strict";(globalThis.webpackChunkspeediful_docs=globalThis.webpackChunkspeediful_docs||[]).push([[240],{2292:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"load-operations/SLAM_lockbuster","title":"SLAM_lockbuster","description":"Specialized data loading procedure that eliminates lock issues associated with bulk loading while also optimizing for speed.","source":"@site/docs/load-operations/SLAM_lockbuster.md","sourceDirName":"load-operations","slug":"/load-operations/SLAM_lockbuster","permalink":"/load-operations/SLAM_lockbuster","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SLAM_load_soap","permalink":"/load-operations/SLAM_load_soap"},"next":{"title":"SOAP Headers","permalink":"/load-operations/SOAP Headers"}}');var i=t(4848),o=t(8453);const s={},a="SLAM_lockbuster",l={},c=[{value:"Recommended Recipes",id:"recommended-recipes",level:2},{value:"Junction Objects",id:"junction-objects",level:3},{value:"QuoteLineItem / SBQQ_QuoteLine__c",id:"quotelineitem--sbqq_quoteline__c",level:3},{value:"OpportunityLineItem",id:"opportunitylineitem",level:3},{value:"CampaignMember",id:"campaignmember",level:3}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"slam_lockbuster",children:"SLAM_lockbuster"})}),"\n",(0,i.jsx)(n.p,{children:"Specialized data loading procedure that eliminates lock issues associated with bulk loading while also optimizing for speed."}),"\n",(0,i.jsxs)(n.admonition,{title:"When to use LockBuster",type:"tip",children:[(0,i.jsx)(n.p,{children:"LockBuster can be used at any time, but excels in situations with high data skew, junction objects, master-detail relationships and roll-up style calculations on related records. We recommend trying LockBuster when you have roughly 100,000 or more records to load"}),(0,i.jsx)(n.p,{children:"To see if you have data skew, look for counts of 6,000 or more in this query. Run this multiple times, replacing lookup_field_n for each lookup or master-detail relationship field that is prone to locking:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT lookup_field_n, COUNT(*) AS count\r\nFROM table_name\r\nGROUP BY lookup_field_n\r\nORDER BY count(*) DESC\n"})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@sObject"})," NVARCHAR, required - Salesforce object name to load data into"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@table"})," NVARCHAR, required - Source SQL table containing data to load"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@operation"})," NVARCHAR, required - Operation type ('insert', 'update', 'upsert', 'delete', 'hardDelete', 'undelete')"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@foreign_keys"})," NVARCHAR, required - Comma-separated list of foreign key column names to analyze for dependencies. Can accept a list of 1, 2 or even more ids (2 is most common). See recommended recipes below"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@batch_size"})," INT, default NULL - Maximum batch size for processing. Note that lockbuster may create batches lower than this size"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@externalId"})," NVARCHAR, default NULL - External ID field name (required for upsert operations)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"recommended-recipes",children:"Recommended Recipes"}),"\n",(0,i.jsx)(n.p,{children:"In general, passing references to grandparent/great-grandparent objects is more conservative and more likely to lead to success than passing a parent object. For example, when loading OpportunityLineItems for a standard Salesforce org, passing the Product Id and Opportunity Id references would be successful. However, if the org has been customized with Opportunity roll-up summaries on the Account, then locking at the Account (grandparent object) could still occur because locks have only been prevented at the Opportunity (parent object) level. Passing the Account Id (grandparent) reference instead of the Opportunity Id (parent) reference will alleviate this issue."}),"\n",(0,i.jsxs)(n.p,{children:["The references passed to ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," do not need to be actual Salesforce fields. In fact, they don't even have to be Salesforce Ids. They could be external ids or other identifiers that describe the relationship of the current object to its predecessors."]}),"\n",(0,i.jsx)(n.h3,{id:"junction-objects",children:"Junction Objects"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use the two lookup/master-detail lookup fields"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"quotelineitem--sbqq_quoteline__c",children:"QuoteLineItem / SBQQ_QuoteLine__c"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Product2Id"}),"\n",(0,i.jsx)(n.li,{children:"QuoteId"}),"\n",(0,i.jsx)(n.li,{children:"Pricebook2Id (if multiple pricebooks in use)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"opportunitylineitem",children:"OpportunityLineItem"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Product2Id"}),"\n",(0,i.jsx)(n.li,{children:"OpportunityId (*)"}),"\n",(0,i.jsx)(n.li,{children:"Pricebook2Id (if multiple pricebooks in use)"}),"\n",(0,i.jsx)(n.li,{children:"Campaign Ultimate Parent Id (**) (if Opportunity Campaigns in use)"}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"Footnotes",type:"note",children:[(0,i.jsx)(n.p,{children:"(*) CampaignId can be used instead of Campaign Ultimate Parent Id if it is permissible to temporarily flatten the Campaign hierarchy (by blanking out the ParentId). The built-in rollup summary in the Campaign hierarchy is prone to causing lock contention due to native Salesforce processing up the hierarchy"}),(0,i.jsx)(n.p,{children:"(*) If there are rollup summaries from Opportunities onto Accounts, replace the OpportuityId with the AccountId"})]}),"\n",(0,i.jsx)(n.h3,{id:"campaignmember",children:"CampaignMember"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Campaign Ultimate Parent Id (*)"}),"\n",(0,i.jsx)(n.li,{children:"ContactId (if Contacts in use)"}),"\n",(0,i.jsx)(n.li,{children:"LeadId (if Leads in use)"}),"\n",(0,i.jsx)(n.li,{children:"AccountId (if Accounts in use)"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Footnotes",type:"note",children:(0,i.jsx)(n.p,{children:"(*) CampaignId can be used instead of Campaign Ultimate Parent Id if it is permissible to temporarily flatten the Campaign hierarchy (by blanking out the ParentId). The built-in rollup summary in the Campaign hierarchy is prone to causing lock contention due to native Salesforce processing up the hierarchy"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage Examples:"})}),"\n",(0,i.jsx)(n.p,{children:"Load CampaignMember records (assuming flat hierarchy):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'CampaignMember',\r\n    @table = 'CampaignMember_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'ContactId,CampaignId'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Load CampaignMember records (assuming nested hierarchy):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Create and Populate the Ultimate_Parent_Id field\r\nALTER TABLE CampaignMember_insert ADD COLUMN UlimateParentId NVARCHAR(18)\r\n\r\nWITH CampaignHierarchy AS (\r\n    SELECT Id, ParentId, Id AS OriginalId FROM CampaignMember_insert\r\n    UNION ALL\r\n    SELECT c.Id, c.ParentId, ch.OriginalId\r\n    FROM CampaignMember_insert c\r\n    INNER JOIN CampaignHierarchy ch ON c.Id = ch.ParentId\r\n),\r\nUltimateParents AS (\r\n    -- Get the ultimate parent for each campaign\r\n    SELECT\r\n        OriginalId,\r\n        Id AS Ultimate_Parent_Id\r\n    FROM CampaignHierarchy\r\n    WHERE ParentId IS NULL\r\n)\r\nUPDATE c\r\nSET c.Ultimate_Parent_Id = up.Ultimate_Parent_Id\r\nFROM CampaignMember_insert c\r\nINNER JOIN UltimateParents up ON c.Id = up.OriginalId;\r\n\r\n-- load\r\nEXEC dbo.SLAM_lockbuster\r\n    @sObject = 'CampaignMember',\r\n    @table = 'CampaignMember_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'ContactId,Ultimate_Parent_Id'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Upsert QuoteLineItem records and create relationships on external ids:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'QuoteLineItem',\r\n    @table = 'QuoteLineItem_upsert',\r\n    @operation = 'upsert',\r\n    @foreign_keys = 'Product2.External_Product2_Id__c,QuoteId.External_Quote_Id__c',\r\n    @batch_size = 10000,\r\n    @externalId = 'External_QuoteLineItem_Id__c'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Delete OpportunityLineItem records:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'OpportunityLineItem',\r\n    @table = 'OpportunityLineItem_delete',\r\n    @operation = 'delete',\r\n    @foreign_keys = 'OpportunityId,Product2Id',\r\n    @batch_size = 10000\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(6540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);