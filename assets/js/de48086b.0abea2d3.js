"use strict";(globalThis.webpackChunkspeediful_docs=globalThis.webpackChunkspeediful_docs||[]).push([[674],{8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var t=r(6540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}},8661:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"load-operations/SLAM_lockbuster","title":"SLAM_lockbuster","description":"Overview","source":"@site/docs/load-operations/SLAM_lockbuster.mdx","sourceDirName":"load-operations","slug":"/load-operations/SLAM_lockbuster","permalink":"/load-operations/SLAM_lockbuster","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SLAM_load_soap","permalink":"/load-operations/SLAM_load_soap"},"next":{"title":"SOAP Headers","permalink":"/load-operations/SOAP Headers"}}');var i=r(4848),o=r(8453),s=r(8787);const l={},c="SLAM_lockbuster",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Recommended Recipes",id:"recommended-recipes",level:2},{value:"Junction Object Recipe",id:"junction-object-recipe",level:3},{value:"QuoteLineItem / SBQQ__QuoteLine__c Recipe",id:"quotelineitem--sbqq__quoteline__c-recipe",level:3},{value:"OpportunityLineItem Recipe",id:"opportunitylineitem-recipe",level:3},{value:"CampaignMember Recipe",id:"campaignmember-recipe",level:3},{value:"Usage Examples",id:"usage-examples",level:2}];function h(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"slam_lockbuster",children:"SLAM_lockbuster"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"LockBuster is a specialized data loading procedure unique to Speediful. It eliminates lock issues commonly experienced with bulk loads while also optimizing for speed. These lock errors are a direct result of the relationships on the object."}),"\n",(0,i.jsx)(n.p,{children:"LockBuster is as simple to use as other Speediful data loading procedure. It only requires the user to provide the relationships that may cause locking."}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When to use LockBuster"})}),(0,i.jsx)(n.p,{children:"LockBuster can be used at any time, but excels in any of these situations:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"High data skew, OR"}),"\n",(0,i.jsx)(n.li,{children:"Junction objects, OR"}),"\n",(0,i.jsx)(n.li,{children:"Objects with master-detail relationships, OR"}),"\n",(0,i.jsx)(n.li,{children:"When the object is included in roll-up style calculations on related records"}),"\n"]}),(0,i.jsx)(n.p,{children:"We recommend trying LockBuster when you have roughly 100,000 or more records to load."}),(0,i.jsx)(n.p,{children:"Data skew in Salesforce occurs when there are large quantities of records that look up to one parent. To see if you have data skew, look for counts of 6,000 or more in this query. Run this multiple times, replacing lookup_field_n for each lookup or master-detail relationship field that is prone to locking:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT lookup_field_n, COUNT(*) AS count\r\nFROM table_name\r\nGROUP BY lookup_field_n\r\nORDER BY count(*) DESC\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsx)(s.A,{children:(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@sObject"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NVARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Required"})}),(0,i.jsx)(n.td,{children:"Salesforce object name to load data into"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@table"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NVARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Required"})}),(0,i.jsx)(n.td,{children:"Input SQL table containing data to load"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@operation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NVARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Required"})}),(0,i.jsxs)(n.td,{children:["Operation type (",(0,i.jsx)(n.code,{children:"'insert'"}),", ",(0,i.jsx)(n.code,{children:"'update'"}),", ",(0,i.jsx)(n.code,{children:"'upsert'"}),", ",(0,i.jsx)(n.code,{children:"'delete'"}),", ",(0,i.jsx)(n.code,{children:"'hardDelete'"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@foreign_keys"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NVARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Required"})}),(0,i.jsx)(n.td,{children:"Comma-separated list of foreign key column names to analyze for dependencies. Can accept a list of 1, 2 or even more ids (2 is most common). See recommended recipes below"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@batch_size"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INT"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NULL"})}),(0,i.jsx)(n.td,{children:"Maximum batch size for processing. Note that lockbuster may create batches lower than this size"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"@externalId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NVARCHAR"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NULL"})}),(0,i.jsx)(n.td,{children:"External ID field name (required for upsert operations)"})]})]})]})}),"\n",(0,i.jsx)(n.h2,{id:"recommended-recipes",children:"Recommended Recipes"}),"\n",(0,i.jsx)(n.p,{children:"In general, passing references to grandparent/great-grandparent objects is more conservative and more likely to lead to success than passing a parent object. For example, when loading OpportunityLineItems for a standard Salesforce org, passing the Product Id and Opportunity Id references would be successful. However, if the org has been customized with Opportunity roll-up summaries on the Account, then locking at the Account (grandparent object) could still occur because locks have only been prevented at the Opportunity (parent object) level. Passing the Account Id (grandparent) reference instead of the Opportunity Id (parent) reference will alleviate this issue."}),"\n",(0,i.jsxs)(n.p,{children:["The references passed to ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," do not need to be actual Salesforce fields or even Salesforce Ids. They could be external ids or other identifiers that describe the relationship of the current object to its predecessors."]}),"\n",(0,i.jsx)(n.h3,{id:"junction-object-recipe",children:"Junction Object Recipe"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The two lookup/master-detail lookup fields"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'Junction_Object__c',\r\n    @table = 'Junction_Object__c_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'Lookup_Field_1__c,Lookup_Field_2__c';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"quotelineitem--sbqq__quoteline__c-recipe",children:"QuoteLineItem / SBQQ__QuoteLine__c Recipe"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Product2Id"}),"\n",(0,i.jsx)(n.li,{children:"QuoteId"}),"\n",(0,i.jsx)(n.li,{children:"Pricebook2Id (if multiple pricebooks in use)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'QuoteLineItem',\r\n    @table = 'QuoteLineItem_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'Product2Id,QuoteId,PricebookEntryId';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"opportunitylineitem-recipe",children:"OpportunityLineItem Recipe"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Product2Id"}),"\n",(0,i.jsx)(n.li,{children:"OpportunityId (*)"}),"\n",(0,i.jsx)(n.li,{children:"Pricebook2Id (if multiple pricebooks in use)"}),"\n",(0,i.jsx)(n.li,{children:"Campaign Ultimate Parent Id (**) (if Opportunity Campaigns in use)"}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"Footnotes",type:"note",children:[(0,i.jsx)(n.p,{children:"(*) CampaignId can be used instead of Campaign Ultimate Parent Id if it is permissible to temporarily flatten the Campaign hierarchy (by blanking out the ParentId). The built-in rollup summary in the Campaign hierarchy is prone to causing lock contention due to native Salesforce processing up the hierarchy"}),(0,i.jsx)(n.p,{children:"(*) If there are rollup summaries from Opportunities onto Accounts, replace the OpportuityId with the AccountId"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'OppoortunityLineItem',\r\n    @table = 'OppoortunityLineItem_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'Product2Id,OpportunityId,PricebookEntryId';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"campaignmember-recipe",children:"CampaignMember Recipe"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"@foreign_keys"})," to"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Campaign Ultimate Parent Id (*)"}),"\n",(0,i.jsx)(n.li,{children:"ContactId (if Contacts in use)"}),"\n",(0,i.jsx)(n.li,{children:"LeadId (if Leads in use)"}),"\n",(0,i.jsx)(n.li,{children:"AccountId (if Accounts in use)"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Footnotes",type:"note",children:(0,i.jsx)(n.p,{children:"(*) CampaignId can be used instead of Campaign Ultimate Parent Id if it is permissible to temporarily flatten the Campaign hierarchy (by blanking out the ParentId). The built-in rollup summary in the Campaign hierarchy is prone to causing lock contention due to native Salesforce processing up the hierarchy"})}),"\n",(0,i.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,i.jsx)(n.p,{children:"Load CampaignMember records (assuming flat hierarchy):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'CampaignMember',\r\n    @table = 'CampaignMember_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'ContactId,CampaignId';\n"})}),"\n",(0,i.jsx)(n.p,{children:"Load CampaignMember records (assuming nested hierarchy):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Create and Populate the Ultimate_Parent_Id field\r\nALTER TABLE CampaignMember_insert ADD COLUMN UlimateParentId NVARCHAR(18)\r\n\r\nWITH CampaignHierarchy AS (\r\n    SELECT Id, ParentId, Id AS OriginalId FROM CampaignMember_insert\r\n    UNION ALL\r\n    SELECT c.Id, c.ParentId, ch.OriginalId\r\n    FROM CampaignMember_insert c\r\n    INNER JOIN CampaignHierarchy ch ON c.Id = ch.ParentId\r\n),\r\nUltimateParents AS (\r\n    -- Get the ultimate parent for each campaign\r\n    SELECT\r\n        OriginalId,\r\n        Id AS Ultimate_Parent_Id\r\n    FROM CampaignHierarchy\r\n    WHERE ParentId IS NULL\r\n)\r\nUPDATE c\r\nSET c.Ultimate_Parent_Id = up.Ultimate_Parent_Id\r\nFROM CampaignMember_insert c\r\nINNER JOIN UltimateParents up ON c.Id = up.OriginalId;\r\n\r\n-- load\r\nEXEC dbo.SLAM_lockbuster\r\n    @sObject = 'CampaignMember',\r\n    @table = 'CampaignMember_insert',\r\n    @operation = 'insert',\r\n    @foreign_keys = 'ContactId,Ultimate_Parent_Id';\n"})}),"\n",(0,i.jsx)(n.p,{children:"Upsert QuoteLineItem records and create relationships on external ids:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'QuoteLineItem',\r\n    @table = 'QuoteLineItem_upsert',\r\n    @operation = 'upsert',\r\n    @foreign_keys = 'Product2.External_Product2_Id__c,QuoteId.External_Quote_Id__c',\r\n    @batch_size = 10000,\r\n    @externalId = 'External_QuoteLineItem_Id__c';\n"})}),"\n",(0,i.jsx)(n.p,{children:"Delete OpportunityLineItem records:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXEC dbo.SLAM_lockbuster\r\n    @sObject = 'OpportunityLineItem',\r\n    @table = 'OpportunityLineItem_delete',\r\n    @operation = 'delete',\r\n    @foreign_keys = 'OpportunityId,Product2Id',\r\n    @batch_size = 10000;\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8787:(e,n,r)=>{r.d(n,{A:()=>a});var t=r(6540),i=r(3427),o=r(6347);const s={apiTable:"apiTable_e8hp"};var l=r(4848);function c({name:e,children:n},r){const s=function(e){let n=e;for(;(0,t.isValidElement)(n);)[n]=t.Children.toArray(n.props.children);if("string"!=typeof n)throw new Error(`Could not extract APITable row name from JSX tree:\n${JSON.stringify(e,null,2)}`);return n}(n),c=e?`${e}-${s}`:s,d=`#${c}`,a=(0,o.W6)();return(0,i.A)().collectAnchor(c),(0,l.jsx)("tr",{id:c,tabIndex:0,ref:a.location.hash===d?r:void 0,onClick:e=>{const n="TD"===e.target.tagName.toUpperCase(),r=!!window.getSelection()?.toString();if(n&&!r){const e=window.scrollX,n=window.scrollY;a.push(d),window.scrollTo(e,n),requestAnimationFrame(()=>{window.scrollTo(e,n)})}},onKeyDown:e=>{if("Enter"===e.key){const e=window.scrollX,n=window.scrollY;a.push(d),window.scrollTo(e,n),requestAnimationFrame(()=>{window.scrollTo(e,n)})}},children:n.props.children})}const d=t.forwardRef(c);function a({children:e,name:n}){if("table"!==e.type)throw new Error("Bad usage of APITable component.\nIt is probably that your Markdown table is malformed.\nMake sure to double-check you have the appropriate number of columns for each table row.");const[r,i]=t.Children.toArray(e.props.children),o=(0,t.useRef)(null);(0,t.useEffect)(()=>{o.current&&(o.current.focus(),o.current.scrollIntoView({behavior:"smooth",block:"center"}))},[]);const c=t.Children.map(i.props.children,e=>(0,l.jsx)(d,{name:n,ref:o,children:e}));return(0,l.jsxs)("table",{className:s.apiTable,children:[r,(0,l.jsx)("tbody",{children:c})]})}}}]);